# OD图表控制器接口文档

## 概述
OD图表控制器提供OD（起始点-目的地）客流图表数据接口，支持矩阵图、桑基图、关系图等多种可视化形式。

## 接口列表

### 1. 获取OD矩阵数据（用于热力图表格）

#### 接口信息
- **接口路径**: `GET /api/od-chart/matrix`
- **功能描述**: 返回适合前端热力图表格展示的OD矩阵数据

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| date | Date | 是 | 指定日期 | 2024-01-01 |

#### 返回数据
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "origins": ["北京南站", "上海虹桥", "广州南站"],
    "destinations": ["上海虹桥", "广州南站", "深圳北站"],
    "matrix": [
      [0, 1500, 800],
      [1500, 0, 1200],
      [800, 1200, 0]
    ],
    "date": "2024-01-01"
  }
}
```

#### 参数说明
- `origins`: 起始站点列表，按字母顺序排序
- `destinations`: 目标站点列表，按字母顺序排序
- `matrix`: 二维数组，表示从起始站点到目标站点的客流量矩阵
- `date`: 查询的日期

---

### 2. 获取OD桑基图数据

#### 接口信息
- **接口路径**: `GET /api/od-chart/sankey`
- **功能描述**: 返回适合前端桑基图展示的OD流向数据

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| date | Date | 是 | 指定日期 | 2024-01-01 |

#### 返回数据
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "nodes": [
      {"name": "北京南站"},
      {"name": "上海虹桥"},
      {"name": "广州南站"}
    ],
    "links": [
      {"source": "北京南站", "target": "上海虹桥", "value": 1500},
      {"source": "上海虹桥", "target": "广州南站", "value": 1200}
    ],
    "date": "2024-01-01"
  }
}
```

#### 参数说明
- `nodes`: 节点列表，包含所有涉及的站点
- `links`: 连接列表，表示站点间的客流流向及数量
- `date`: 查询的日期

---

### 3. 获取OD关系图数据

#### 接口信息
- **接口路径**: `GET /api/od-chart/relation`
- **功能描述**: 返回适合前端关系图展示的节点和连线数据

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| date | Date | 是 | 指定日期 | 2024-01-01 |

#### 返回数据
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "nodes": [
      {"id": "北京南站", "name": "北京南站", "symbolSize": 10},
      {"id": "上海虹桥", "name": "上海虹桥", "symbolSize": 10},
      {"id": "广州南站", "name": "广州南站", "symbolSize": 10}
    ],
    "edges": [
      {
        "source": "北京南站", 
        "target": "上海虹桥", 
        "value": 1500,
        "lineStyle": {"width": 15}
      },
      {
        "source": "上海虹桥", 
        "target": "广州南站", 
        "value": 1200,
        "lineStyle": {"width": 12}
      }
    ],
    "date": "2024-01-01"
  }
}
```

#### 参数说明
- `nodes`: 节点列表，包含站点ID、名称和显示大小
- `edges`: 边列表，表示站点间的连接关系
- `date`: 查询的日期

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

## 使用建议

1. **日期参数格式**: 日期参数必须使用 `yyyy-MM-dd` 格式
2. **数据存在性**: 确保查询的日期在数据库中存在对应的客流数据
3. **性能优化**: 对于大量数据的查询，建议添加适当的缓存机制
4. **异常处理**: 前端应处理可能的网络异常和数据格式错误

## 前端开发建议

### 1. 图表库选择
- **ECharts**: 支持热力图、桑基图、关系图等多种图表类型
- **D3.js**: 适合复杂的数据可视化需求
- **AntV G6**: 专注于关系图和流程图的展示

### 2. 数据处理
- 对返回的矩阵数据进行预处理，过滤掉客流量为0的OD对
- 根据客流量大小调整图表元素的样式（颜色深浅、线条粗细等）
- 对于大矩阵，考虑分页或缩放功能

### 3. 用户交互
- 添加时间选择器，支持不同日期的OD数据对比
- 提供筛选功能，支持按站点或客流量范围筛选
- 实现图表之间的联动效果，点击某个站点高亮相关连接